<header class="sticky top-0 z-50 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-800">
  <div class="max-w-screen-xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
    <!-- Logo -->
    <div class="flex items-center gap-3 cursor-pointer select-none" (click)="irAInicio()">
      <svg class="w-9 h-9 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
      <span class="text-2xl font-bold text-blue-700 dark:text-blue-400 tracking-tight">AITStore</span>
    </div>

    <!-- Buscador escritorio -->
    <div class="hidden md:flex flex-1 max-w-lg">
      <div class="flex w-full rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 shadow-sm">
        <input [(ngModel)]="searchTerm" (keyup.enter)="buscar()" type="text"
               placeholder="Buscar productos..."
               class="w-full px-4 py-2 text-sm bg-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none">
        <button (click)="buscar()" class="px-4 bg-blue-600 text-white hover:bg-blue-700 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Escritorio: menú horizontal -->
    <nav class="hidden md:flex items-center gap-5 text-sm font-medium text-gray-800 dark:text-gray-200">
      <a routerLink="/" (click)="cerrarMenus()" class="hover:text-blue-600 dark:hover:text-blue-300">Inicio</a>

      <div class="relative" *ngIf="categoriasAgrupadas">
        <button (click)="toggleMenu()" class="hover:text-blue-600 dark:hover:text-blue-300 flex items-center gap-1">
          Categorías
          <svg class="w-4 h-4 transform" [class.rotate-180]="menuAbierto" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>

        <div *ngIf="menuAbierto" class="absolute left-0 mt-2 w-64 max-h-[70vh] overflow-auto bg-white dark:bg-gray-800 shadow-xl border border-gray-200 dark:border-gray-700 rounded-lg z-50 p-3 space-y-2">
          <div *ngFor="let grupo of categoriasAgrupadas | keyvalue">
            <button (click)="toggleGrupo(grupo.key)" class="w-full text-left font-semibold text-blue-700 dark:text-blue-300 hover:underline flex items-center justify-between">
              {{ grupo.key }}
              <svg class="w-4 h-4" [class.rotate-180]="categoriasDesplegadas[grupo.key]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
            <div *ngIf="categoriasDesplegadas[grupo.key]" class="pl-3 pt-1 space-y-1">
              <a *ngFor="let cat of grupo.value"
                 (click)="irACategoria(cat.id)"
                 class="block px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 cursor-pointer text-sm">
                {{ cat.nombre }}
              </a>
            </div>
          </div>
        </div>
      </div>

      <a routerLink="/carrito" class="relative hover:text-blue-600 dark:hover:text-blue-300">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.35 2.7a1 1 0 00.9 1.5h11m-12-4h12m-4 5a1 1 0 11-2 0 1 1 0 012 0zm-8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
        </svg>
        <span *ngIf="cantidadTotal > 0" class="absolute -top-2 -right-3 bg-red-600 text-white text-xs rounded-full px-1">
          {{ cantidadTotal }}
        </span>
      </a>

      <ng-container *ngIf="!autenticado">
        <a routerLink="/auth/login" class="hover:text-blue-600 dark:hover:text-blue-300">Ingresar</a>
        <a routerLink="/auth/register" class="bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700">Registro</a>
      </ng-container>

      <ng-container *ngIf="autenticado">
        <div class="relative">
          <button (click)="togglePerfilMenu()" class="w-9 h-9 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
            {{ inicial }}
          </button>
          <div *ngIf="perfilMenuAbierto" class="absolute right-0 mt-2 w-44 bg-white dark:bg-gray-800 shadow-lg border rounded-lg z-50 p-2">
            <a (click)="irAPerfil()" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm">Perfil</a>
            <button (click)="logout()" class="block w-full text-left px-4 py-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-800 text-sm">
              Cerrar sesión
            </button>
          </div>
        </div>
      </ng-container>
    </nav>

    <!-- Botón menú móvil -->
    <button (click)="toggleMenu()" class="md:hidden text-gray-800 dark:text-gray-200">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M3 6h18M3 12h18M3 18h18"/>
      </svg>
    </button>
  </div>

  <!-- Menú móvil -->
  <div *ngIf="menuAbierto" class="md:hidden border-t border-gray-200 dark:border-gray-700 px-4 py-4 bg-white dark:bg-gray-900">
    <!-- Buscador móvil -->
    <div class="mb-4">
      <div class="flex w-full rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
        <input [(ngModel)]="searchTerm" (keyup.enter)="buscar()" type="text"
               placeholder="Buscar productos..."
               class="w-full px-4 py-2 text-sm bg-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none">
        <button (click)="buscar()" class="px-4 bg-blue-600 text-white hover:bg-blue-700 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Enlaces móviles -->
    <a routerLink="/" (click)="cerrarMenus()" class="block py-2 text-sm hover:text-blue-600 dark:hover:text-blue-300">Inicio</a>

    <div *ngFor="let grupo of categoriasAgrupadas | keyvalue" class="mb-2">
      <button (click)="toggleGrupo(grupo.key)" class="w-full text-left font-semibold text-blue-700 dark:text-blue-300 hover:underline flex items-center justify-between">
        {{ grupo.key }}
        <svg class="w-4 h-4" [class.rotate-180]="categoriasDesplegadas[grupo.key]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M6 9l6 6 6-6"/>
        </svg>
      </button>
      <div *ngIf="categoriasDesplegadas[grupo.key]" class="pl-4 pt-1 space-y-1">
        <a *ngFor="let cat of grupo.value"
           (click)="irACategoria(cat.id); cerrarMenus()"
           class="block py-1 text-sm hover:text-blue-600 dark:hover:text-blue-300 cursor-pointer">
          {{ cat.nombre }}
        </a>
      </div>
    </div>

    <a routerLink="/carrito" (click)="cerrarMenus()" class="block py-2 text-sm hover:text-blue-600 dark:hover:text-blue-300">
      Carrito ({{ cantidadTotal }})
    </a>

    <ng-container *ngIf="autenticado">
      <a (click)="irAPerfil(); cerrarMenus()" class="block py-2 text-sm hover:text-blue-600 dark:hover:text-blue-300">Perfil</a>
      <button (click)="logout(); cerrarMenus()" class="block w-full text-left py-2 text-sm text-red-600 hover:text-red-800">Cerrar sesión</button>
    </ng-container>

    <ng-container *ngIf="!autenticado">
      <a routerLink="/auth/login" (click)="cerrarMenus()" class="block py-2 text-sm hover:text-blue-600 dark:hover:text-blue-300">Ingresar</a>
      <a routerLink="/auth/register" (click)="cerrarMenus()" class="block py-2 text-sm hover:text-blue-600 dark:hover:text-blue-300">Registro</a>
    </ng-container>
  </div>
</header>
