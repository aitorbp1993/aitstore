<header class="sticky top-0 z-50 bg-[#1e293b] text-white backdrop-blur-md transition-shadow"
        [ngClass]="{
  'shadow-sm border-b border-slate-700': !scrolled,
  'shadow-lg border-b border-blue-800': scrolled
}">
  <div class="max-w-screen-xl mx-auto px-4 py-3 flex items-center justify-between gap-6 text-white">

    <!-- Logo -->
    <div class="flex items-center gap-3 cursor-pointer select-none" (click)="irAInicio()">
      <svg class="w-9 h-9 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
      </svg>
      <span class="text-2xl sm:text-3xl font-bold tracking-tight text-blue-400">AITStore</span>
    </div>

    <!-- Buscador escritorio -->
    <div class="flex-1 max-w-2xl hidden sm:flex">
      <div class="flex w-full rounded-full overflow-hidden border border-slate-600 bg-slate-800 shadow-sm">
        <input [(ngModel)]="searchTerm" (keyup.enter)="buscar()" type="text" placeholder="Buscar productos..."
          class="w-full px-4 py-2 text-sm bg-transparent text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <button (click)="buscar()" class="px-4 bg-blue-600 text-white hover:bg-blue-700 transition font-semibold flex items-center">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="M21 21l-4.35-4.35" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Navegación escritorio -->
    <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-white">
      <a routerLink="/" (click)="cerrarMenus()" class="hover:text-blue-400 transition">Inicio</a>

      <!-- Categorías agrupadas -->
      <div class="relative">
        <button (click)="toggleCategorias()" class="flex items-center gap-1 hover:text-blue-400 transition">
          Categorías
          <svg class="w-4 h-4 transform transition-transform" [ngClass]="{ 'rotate-180': categoriasDesplegadas }" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6" />
          </svg>
        </button>
        <div *ngIf="categoriasDesplegadas"
             class="absolute right-0 mt-2 w-64 max-h-[400px] overflow-auto bg-slate-800 text-white shadow-lg rounded-lg py-2 border border-slate-600 z-50 animate-pop-in">
          <ng-container *ngFor="let grupo of categoriasAgrupadas">
            <div>
              <button (click)="toggleSubmenu(grupo.grupo)"
                      class="w-full text-left flex justify-between items-center px-4 py-2 font-semibold hover:bg-slate-700">
                {{ grupo.grupo }}
                <svg class="w-4 h-4 transition-transform" [ngClass]="{ 'rotate-90': submenusAbiertos[grupo.grupo] }" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 6l6 6-6 6" />
                </svg>
              </button>
              <div *ngIf="submenusAbiertos[grupo.grupo]" class="pl-6">
                <a *ngFor="let cat of grupo.items"
                   (click)="irACategoria(cat.id)"
                   class="block px-4 py-1 text-sm hover:bg-slate-700 cursor-pointer">
                  {{ cat.nombre }}
                </a>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Carrito -->
      <a routerLink="/carrito" (click)="cerrarMenus()" class="relative hover:text-blue-400 transition flex items-center">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.35 2.7a1 1 0 00.9 1.5h11m-12-4h12m-4 5a1 1 0 11-2 0 1 1 0 012 0zm-8 0a1 1 0 11-2 0 1 1 0 012 0z" />
        </svg>
        <span *ngIf="cantidadTotal > 0" class="absolute -top-2 -right-3 bg-red-600 text-white text-xs rounded-full px-1.5 font-semibold">
          {{ cantidadTotal }}
        </span>
      </a>

      <!-- Perfil -->
      <ng-container *ngIf="autenticado; else noAuth">
        <div class="relative">
        <!-- Botón perfil escritorio -->
<button (click)="togglePerfilMenu()"
        class="avatar-perfil w-9 h-9 rounded-full bg-blue-600 text-white flex items-center justify-center font-semibold hover:ring-2 ring-blue-400 transition">
  {{ inicial }}
</button>

          <div *ngIf="perfilMenuAbierto" class="perfil-dropdown">
            <a (click)="irAPerfil(); togglePerfilMenu()">Perfil</a>
            <button (click)="logout(); togglePerfilMenu()" class="cerrar">Cerrar sesión</button>
          </div>
        </div>
      </ng-container>

      <ng-template #noAuth>
        <a routerLink="/auth/login" (click)="cerrarMenus()" class="hover:text-blue-400">Ingresar</a>
        <a routerLink="/auth/register" (click)="cerrarMenus()" class="px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition">Registro</a>
      </ng-template>
    </nav>

    <!-- Menú móvil -->
    <div class="md:hidden flex items-center gap-3 ml-auto">
      <button (click)="toggleMenu()" class="text-white">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M3 12h18M3 18h18" />
        </svg>
      </button>

      <ng-container *ngIf="autenticado; else noAuthMobile">
      <!-- Botón perfil escritorio -->
<button (click)="togglePerfilMenu()"
        class="avatar-perfil w-9 h-9 rounded-full bg-blue-600 text-white flex items-center justify-center font-semibold hover:ring-2 ring-blue-400 transition">
  {{ inicial }}
</button>

        <div *ngIf="perfilMenuAbierto" class="perfil-dropdown">
          <a (click)="irAPerfil(); togglePerfilMenu()">Perfil</a>
          <button (click)="logout(); togglePerfilMenu()" class="cerrar">Cerrar sesión</button>
        </div>
      </ng-container>

      <ng-template #noAuthMobile>
        <button (click)="togglePerfilMenu()" class="w-9 h-9 bg-blue-600 text-white rounded-full flex items-center justify-center">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 3a4 4 0 100 8 4 4 0 000-8z" />
          </svg>
        </button>
        <div *ngIf="perfilMenuAbierto" class="perfil-dropdown">
          <a routerLink="/auth/login" (click)="togglePerfilMenu()">Ingresar</a>
          <a routerLink="/auth/register" (click)="togglePerfilMenu()">Registrarse</a>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Navegación móvil desplegable -->
  <div *ngIf="menuAbierto" class="md:hidden bg-[#1e293b] text-white border-t border-slate-700 px-4 py-4 animate-pop-in">
    <div class="flex flex-col gap-4 text-sm">
      <a routerLink="/" (click)="cerrarMenus()">Inicio</a>
      <div *ngFor="let grupo of categoriasAgrupadas">
        <button (click)="toggleSubmenu(grupo.grupo)" class="w-full text-left font-semibold flex justify-between items-center">
          {{ grupo.grupo }}
          <svg class="w-4 h-4" [ngClass]="{ 'rotate-90': submenusAbiertos[grupo.grupo] }" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>
        <div *ngIf="submenusAbiertos[grupo.grupo]" class="pl-4">
          <a *ngFor="let cat of grupo.items" (click)="irACategoria(cat.id)" class="block py-1 hover:text-blue-400">
            {{ cat.nombre }}
          </a>
        </div>
      </div>
      <a routerLink="/carrito" (click)="cerrarMenus()">Carrito ({{ cantidadTotal }})</a>
      <ng-container *ngIf="autenticado">
        <a (click)="irAPerfil(); cerrarMenus()">Perfil</a>
        <button (click)="logout(); cerrarMenus()" class="text-left text-red-500">Cerrar sesión</button>
      </ng-container>
    </div>
  </div>

  <!-- Popup -->
  <div *ngIf="mensajePopup" class="fixed bottom-6 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50 animate-fade-slide">
    {{ mensajePopup }}
  </div>
</header>
